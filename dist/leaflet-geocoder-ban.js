'use strict';/* global define, XMLHttpRequest */var f=function(a,b){// Universal Module Definition
if('function'==typeof define&&define.amd)define(['leaflet'],a);else if('undefined'!=typeof module)// Node/CommonJS
module.exports=a(require('leaflet'));else{// Browser globals
if('undefined'==typeof b.L)throw new Error('Leaflet must be loaded first');a(b.L)}},factory=function(b){b.GeocoderBAN=b.Control.extend({options:{position:'topleft',style:'control',placeholder:'adresse',resultsNumber:7,collapsed:!0,serviceUrl:'https://api-adresse.data.gouv.fr/search/',minIntervalBetweenRequests:250,defaultMarkgeocode:!0,autofocus:!0},includes:b.Evented.prototype||b.Mixin.Events,initialize:function c(a){b.Util.setOptions(this,a)},onRemove:function b(a){a.off('click',this.collapseHack,this)},onAdd:function h(a){var c,d=this.container=b.DomUtil.create('div','leaflet-control-geocoder-ban leaflet-bar'),e=this.icon=b.DomUtil.create('button','leaflet-control-geocoder-ban-icon',d),f=this.form=b.DomUtil.create('div','leaflet-control-geocoder-ban-form',d);if(a.on('click',this.collapseHack,this),e.innerHTML='&nbsp;',e.type='button',c=this.input=b.DomUtil.create('input','',f),c.type='text',c.placeholder=this.options.placeholder,this.alts=b.DomUtil.create('ul','leaflet-control-geocoder-ban-alternatives leaflet-control-geocoder-ban-alternatives-minimized',d),b.DomEvent.on(e,'click',function(a){this.toggle(),b.DomEvent.preventDefault(a)},this),b.DomEvent.addListener(c,'keyup',this.keyup,this),b.DomEvent.disableScrollPropagation(d),b.DomEvent.disableClickPropagation(d),this.options.collapsed||(this.expand(),this.options.autofocus&&setTimeout(function(){c.focus()},250)),'searchBar'===this.options.style){b.DomUtil.addClass(d,'searchBar');var g=document.getElementsByClassName('leaflet-control-container')[0];return g.appendChild(d),b.DomUtil.create('div','hidden')}return d},minimizeControl:function a(){'control'===this.options.style?this.collapse():b.DomUtil.addClass(this.alts,'leaflet-control-geocoder-ban-alternatives-minimized')},toggle:function a(){'searchBar'!=this.style&&(b.DomUtil.hasClass(this.container,'leaflet-control-geocoder-ban-expanded')?this.collapse():this.expand())},expand:function a(){b.DomUtil.addClass(this.container,'leaflet-control-geocoder-ban-expanded'),this.geocodeMarker&&this._map.removeLayer(this.geocodeMarker),this.input.select()},collapse:function a(){b.DomUtil.removeClass(this.container,'leaflet-control-geocoder-ban-expanded'),b.DomUtil.addClass(this.alts,'leaflet-control-geocoder-ban-alternatives-minimized'),this.input.blur()},collapseHack:function b(a){a.originalEvent instanceof MouseEvent&&this.minimizeControl()},moveSelection:function f(a){var c,d=document.getElementsByClassName('leaflet-control-geocoder-ban-selected');if(!d.length)c=this.alts[0>a?'firstChild':'lastChild'],b.DomUtil.addClass(c,'leaflet-control-geocoder-ban-selected');else{var e=d[0];b.DomUtil.removeClass(e,'leaflet-control-geocoder-ban-selected'),c=0<a?e.previousElementSibling?e.previousElementSibling:this.alts.lastChild:e.nextElementSibling?e.nextElementSibling:this.alts.firstChild}c&&b.DomUtil.addClass(c,'leaflet-control-geocoder-ban-selected')},keyup:function g(c){switch(c.keyCode){case 27:this.minimizeControl(),b.DomEvent.preventDefault(c);break;case 38:this.moveSelection(1),b.DomEvent.preventDefault(c);break;case 40:this.moveSelection(-1),b.DomEvent.preventDefault(c);break;case 13:// enter
var d=document.getElementsByClassName('leaflet-control-geocoder-ban-selected');d.length&&this.geocodeResult(d[0].geocodedFeatures),b.DomEvent.preventDefault(c);break;default:if(this.input.value){var e={q:this.input.value,limit:this.options.resultsNumber},f=this;this.setTimeout&&clearTimeout(this.setTimeout),this.setTimeout=setTimeout(function(){a(f.options.serviceUrl,e,f.displayResults(f))},this.options.minIntervalBetweenRequests)}else this.clearResults();b.DomEvent.preventDefault(c);}},clearResults:function a(){for(;this.alts.firstChild;)this.alts.removeChild(this.alts.firstChild)},displayResults:function c(a){return a.clearResults(),function(c){var d=Math.min;if(c&&c.features){var e=c.features;b.DomUtil.removeClass(a.alts,'leaflet-control-geocoder-ban-alternatives-minimized');for(var f=0;f<d(e.length,a.options.resultsNumber);f++)a.alts.appendChild(a.createAlt(e[f],f))}}},createAlt:function a(c,d){var e=b.DomUtil.create('li',''),f=b.DomUtil.create('a','',e);e.setAttribute('data-result-index',d),f.innerHTML='<strong>'+c.properties.label+'</strong>, '+c.properties.context,e.geocodedFeatures=c;return b.DomEvent.on(e,'click',function a(){this.minimizeControl(),this.geocodeResult(c)},this),b.DomEvent.on(e,'mouseover',function c(){var a=document.getElementsByClassName('leaflet-control-geocoder-ban-selected');a.length&&b.DomUtil.removeClass(a[0],'leaflet-control-geocoder-ban-selected'),b.DomUtil.addClass(e,'leaflet-control-geocoder-ban-selected')},this),b.DomEvent.on(e,'mouseout',function a(){b.DomUtil.removeClass(e,'leaflet-control-geocoder-ban-selected')},this),e},geocodeResult:function b(a){this.minimizeControl(),this.markGeocode(a)},markGeocode:function d(a){var c=[a.geometry.coordinates[1],a.geometry.coordinates[0]];this._map.setView(c,14),this.geocodeMarker=new b.Marker(c).bindPopup(a.properties.label).addTo(this._map).openPopup()}});var a=function(a,c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){4!==e.readyState||200!==e.status&&304!==e.status||d(JSON.parse(e.response))},e.open('GET',a+b.Util.getParamString(c),!0),e.setRequestHeader('Accept','application/json'),e.send(null)};return b.geocoderBAN=function(a){return new b.GeocoderBAN(a)},b.GeocoderBAN};f(factory,window);